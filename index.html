<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Slither.io 2 Player</title>
<style>
body { margin:0; overflow:hidden; background:#111; font-family:sans-serif; }
canvas { display:block; background:#111; }
#leaderboard { position:fixed; top:10px; right:10px; background:rgba(0,0,0,0.6); color:white; padding:10px 20px; border-radius:10px; font-family:monospace; font-size:16px; }
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="leaderboard"></div>

<script>
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const leaderboard = document.getElementById('leaderboard');

// --- Game constants ---
const MAP_SIZE = 5000, MAP_RADIUS = MAP_SIZE/2;

// --- Players ---
let player1 = { name: "Player 1", color: "cyan", snake:[{x:0,y:0}], angle:0, targetAngle:0, length:100, speed:2.8, boosting:false, score:0, thickness:10 };
let player2 = { name: "Player 2", color: "magenta", snake:[{x:100,y:100}], angle:0, targetAngle:0, length:100, speed:2.8, boosting:false, score:0, thickness:10 };
let food = [];

// --- Create food ---
for(let i=0;i<200;i++){
  food.push({x:Math.random()*MAP_SIZE-MAP_RADIUS, y:Math.random()*MAP_SIZE-MAP_RADIUS});
}

// --- Distance function ---
function distance(a,b){ return Math.hypot(a.x-b.x,a.y-b.y); }

// --- Update snake ---
function updateSnake(p, keys={}){
  p.speed = p.boosting ? 5 : 2.8;

  if(keys.up) p.targetAngle = -Math.PI/2;
  if(keys.down) p.targetAngle = Math.PI/2;
  if(keys.left) p.targetAngle = Math.PI;
  if(keys.right) p.targetAngle = 0;

  let diff = p.targetAngle - p.angle;
  if(diff > Math.PI) diff -= 2*Math.PI;
  if(diff < -Math.PI) diff += 2*Math.PI;
  p.angle += diff*0.15;

  let head = { x: p.snake[0].x + Math.cos(p.angle)*p.speed, y: p.snake[0].y + Math.sin(p.angle)*p.speed };
  const distToCenter = Math.hypot(head.x, head.y);
  if(distToCenter + p.thickness > MAP_RADIUS){
    const angle = Math.atan2(head.y, head.x);
    const over = distToCenter + p.thickness - MAP_RADIUS;
    head.x -= Math.cos(angle)*over;
    head.y -= Math.sin(angle)*over;
  }
  p.snake.unshift(head);
  while(p.snake.length > p.length) p.snake.pop();

  // Eat food
  for(let i=food.length-1;i>=0;i--){
    if(distance(head, food[i])<20){
      p.length += 2;
      p.score += 10;
      food[i] = {x:Math.random()*MAP_SIZE-MAP_RADIUS, y:Math.random()*MAP_SIZE-MAP_RADIUS};
    }
  }
}

// --- Drop food from dead snake ---
function dropFood(snake){
  const count = Math.floor(snake.length / 4);
  for(let i=0; i<count; i++){
    const seg = snake.snake[i] || snake.snake[0];
    food.push({x: seg.x + (Math.random()-0.5)*20, y: seg.y + (Math.random()-0.5)*20});
  }
}

// --- Check collisions between snakes ---
function checkCollisions(){
  const players = [player1, player2];
  for(let i=0;i<players.length;i++){
    const p = players[i];
    const other = players[1-i]; // the other player

    for(let j=1;j<other.snake.length;j++){ // start at 1 to avoid head-on collision
      if(distance(p.snake[0], other.snake[j]) < other.thickness){
        // Drop food
        dropFood(p);

        // Reset player
        p.length = 100;
        p.score = Math.max(0, p.score-50);
        p.snake = [{x: Math.random()*MAP_SIZE-MAP_RADIUS, y: Math.random()*MAP_SIZE-MAP_RADIUS}];
      }
    }
  }
}

// --- Draw snake ---
function drawSnake(p, camX, camY){
  for(let i=0;i<p.snake.length;i++){
    const seg = p.snake[i];
    const r = p.thickness*(0.5+0.5*i/p.snake.length);
    const x = seg.x-camX+canvas.width/2;
    const y = seg.y-camY+canvas.height/2;
    ctx.fillStyle = p.color;
    ctx.beginPath();
    ctx.arc(x,y,r,0,Math.PI*2);
    ctx.fill();
  }
}

// --- Draw food ---
function drawFood(camX, camY){
  ctx.fillStyle="yellow";
  food.forEach(f=>{
    const x = f.x - camX + canvas.width/2;
    const y = f.y - camY + canvas.height/2;
    ctx.beginPath();
    ctx.arc(x,y,6,0,Math.PI*2);
    ctx.fill();
  });
}

// --- Draw leaderboard ---
function drawLeaderboard(){
  const all = [player1, player2].sort((a,b)=>b.score-a.score);
  leaderboard.innerHTML = `<b>Leaderboard</b><br>` + all.map((p,i)=>`${i+1}. ${p.name}: ${p.score}`).join("<br>");
}

// --- Keyboard controls ---
const keys1 = { up:false, down:false, left:false, right:false };
const keys2 = { up:false, down:false, left:false, right:false };

window.addEventListener("keydown", e=>{
  // Player 1 - WASD + Shift
  if(e.key.toLowerCase()==='w') keys1.up=true;
  if(e.key.toLowerCase()==='s') keys1.down=true;
  if(e.key.toLowerCase()==='a') keys1.left=true;
  if(e.key.toLowerCase()==='d') keys1.right=true;
  if(e.key==='Shift') player1.boosting=true;

  // Player 2 - Arrow keys + M
  if(e.key==='ArrowUp') keys2.up=true;
  if(e.key==='ArrowDown') keys2.down=true;
  if(e.key==='ArrowLeft') keys2.left=true;
  if(e.key==='ArrowRight') keys2.right=true;
  if(e.key.toLowerCase()==='m') player2.boosting=true;
});
window.addEventListener("keyup", e=>{
  if(e.key.toLowerCase()==='w') keys1.up=false;
  if(e.key.toLowerCase()==='s') keys1.down=false;
  if(e.key.toLowerCase()==='a') keys1.left=false;
  if(e.key.toLowerCase()==='d') keys1.right=false;
  if(e.key==='Shift') player1.boosting=false;

  if(e.key==='ArrowUp') keys2.up=false;
  if(e.key==='ArrowDown') keys2.down=false;
  if(e.key==='ArrowLeft') keys2.left=false;
  if(e.key==='ArrowRight') keys2.right=false;
  if(e.key.toLowerCase()==='m') player2.boosting=false;
});

// --- Game loop ---
function gameLoop(){
  ctx.fillStyle="rgba(0,0,0,0.3)";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  const camX = (player1.snake[0].x + player2.snake[0].x)/2;
  const camY = (player1.snake[0].y + player2.snake[0].y)/2;

  updateSnake(player1, keys1);
  updateSnake(player2, keys2);
  checkCollisions();

  drawFood(camX, camY);
  drawSnake(player1, camX, camY);
  drawSnake(player2, camX, camY);
  drawLeaderboard();

  requestAnimationFrame(gameLoop);
}
gameLoop();
</script>
</body>
</html>
